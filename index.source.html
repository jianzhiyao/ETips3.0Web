<!DOCTYPE html>
<html>
<head>
<title></title>
<meta charset="utf-8"/>
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
<script src="js/jquery.js"></script>
<script src="js/jquery.mobile-1.4.0-rc.1.js"></script>
<script src="pinyin.js"></script>
<style>
div.right{
	float:right;
}
</style>
</head>
<body>
<div data-role="page" id="homepage">
  <div data-role="header">
    <a data-icon="home" href="#homepage"  >首页</a>
    <h1>博智平台</h1>
  </div>
  <div data-role="content">
  <center>关注微信号wyubozhi</center>
  <ul data-role="listview" data-inset="true">
    	<li data-role="list-divider">校园小助手</li>
        <li><a href="#newspage" data-transition="slide">校内资讯</a></li>
        <li><a href="#checkpage" data-transition="slide">查询成绩(绩点)/课表</a></li>
        <li><a href="#scorepage" data-transition="slide">我的成绩单</a></li>
        <li><a href="#coursepage" data-transition="slide">我的课程表</a></li>
        <li><a href="#checkcetpage" data-transition="slide">查询英语四六级成绩</a></li>
	</ul>
	<ul data-role="listview" data-inset="true">
    	<li data-role="list-divider">生活小助手</li>
        <li><a href="#weatherpage" data-transition="slide">天气预报</a></li>
        <li ><a href="#shoppingpage"  data-transition="slide">五邑大学周边</a></li>
        <li><a href="#buspage"  data-transition="slide">五邑公交/城际客车查询</a></li>
		<li><a href="http://i.waimai.meituan.com/home/ws02t6q0c442"  data-transition="slide">五邑大学周边外卖</a></li>
		<li><a href="http://tuan.baidu.com/jiangmen/" data-transition="slide">江门周边团购</a></li>
        <!--<li><a href="#locationpage" onclick="getLocation()" >获得自己当前位置</a></li>-->
	</ul>
    <a href="#announcement" data-role="button" data-transition="slide">平台声明</a>
  </div>
  <div data-role="footer">
  </div>
</div> 

<div data-role="page" id="checkpage">
  <div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a><h1>查询成绩/课表</h1>
  </div>
  <div data-role="content"><br><br>
  <form action="index.php" method="get">
  	子系统账号:<input data-inline="true" type="text" id="username" name="username" />
	子系统密码:<input data-inline="true" type="password" id="password" name="password"/>
    <select name="action" id="action">
    <option value="">选择查询的项目</option>
    <option value="score">查询分数</option>
    <option value="course">查询课表</option>
    </select><br>
	<input type="button" value="查询"   onclick="checkForm(this)" data-transition="slide"/>
    <center>(点击查询后稍等)</center>
   </form>
   </div>
   <div data-role="footer">
  </div>
</div>

<div data-role="page" id="checkcetpage">
  <div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a><h1>查询英语四六级成绩(博智平台，专属邑大的资讯平台)</h1>
  </div>
  <div data-role="content"><br><br>
  <center>邑大学子欢迎关注公众号wyubozhi,获得更多服务<br><br>(8月20日上午9点起,可以查询2014年6月的CET4，6成绩)</center><br><br>
  <form action="" method="get">
  	准考证号:<input data-inline="true" type="text" id="zkzh" name="zkzh" />
	姓　　名:<input data-inline="true" type="text" id="xm" name="xm"/>
    <center>姓名超过3个字，可只输入前3个</center>
	<input type="button" value="查询"  onclick="getCetScore()"/>
    <center>欢迎转发到朋友圈</center>
   </form>
   </div>
   <div data-role="footer">
  </div>
</div>

<div data-role="page" id="weatherpage">
  <div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a><h1>天气查询</h1>
  </div>
  <div data-role="content"><br><br>
  <center>邑大学子欢迎关注公众号wyubozhi,获得更多服务<br><input type="text" id="wcity" value="江门"/><button onClick="changeWCity()">查询城市天气(简体或拼音)</button></center>
  <center><iframe id="weatherif" name="weather_inc" src="http://cache.xixik.com.cn/3/jiangmen/" width="100%" height="370" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" ></iframe></center>
   </div>
   <div data-role="footer">
  </div>
</div>

<div data-role="page" id="cetscorepage">
  <div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a><h1>四六级成绩</h1>
  </div>
  <div data-role="content" id="cetscorecontent">
  <br><br><br><br><br><br><a href="#checkcetpage" data-role="button">若无内容请先到查询页面查询</a>
   </div>
   <div data-role="footer">
  </div>
</div>

<div data-role="dialog" id="tips_dialog" data-theme="b">
	<div data-role="header" data-theme="b">
    <h1>提示</h1><br>
    <div data-role="content">
        <div id="tips">
        </div>
        <center><a data-role="button" data-rel="back" >返回</a></center>
    </div>
    </div>
</div>

<div data-role="page" id="announcement" data-theme="b">
    <div data-role="header">
    <a data-icon="home" href="#homepage"  >首页</a>
    <h1>平台声明</h1>
  </div>
  <div data-role="content">
  <h1>平台声明：</h1>
  1.本平台<font color="red">只允许</font>博智平台微信号(wyubozhi)使用<br><br>
  2.本平台所有功能都是免费提供<br><br>
  3.本平台的外卖和团购的外链并未收取任何商家的费用<br><br>
  4.本平台由五邑大学<font color="blue">袂卓工作室</font>提供技术支持<br><br>
  5.本平台拥有对博智平台的<font color="red">最终解释权</font><br><br>
  6.若有商家有意商业合作，请联系邮箱739319867@qq.com
  </div>
  <div data-role="footer">
  </div>
</div>

<div data-role="page" id="scorepage">
	<div data-role="header">
    <a data-icon="home" href="#homepage"  >首页</a>
    <h1>成绩单</h1>
  </div>
  <div data-role="content" id="scorecontent">
		<h2>我的成绩单</h2>
  <ul data-role="listview"  data-inset="true" id="scorelist">
  	<a href="#checkpage" data-role="button"  data-transition="slide" data-direction="reverse">请先到查询页面查询</a>
  </ul>
  </div>
  <div data-role="footer">
  </div>
</div>

<div data-role="page" id="coursepage">
	<div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a>
    <h1>课程表</h1>
  </div>
  <div data-role="content" id="coursecontent">
		<h2>我的课表</h2>
        <a href="#checkpage" data-role="button">若无内容请先到查询页面查询</a>
        <center>
        <table id="coursetable" border="1" cellspacing="0">
        </table></center>
  </div>
  <div data-role="footer">
  </div>
</div>

<div data-role="page" id="buspage">
	<div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a>
    <h1>公交/客车线路查询</h1>
  </div>
  <div data-role="content" id="checkbuscontent">
		<h2 id="buslinetitle">市内公交线路查询</h2>
        <select onChange="changeForm(this)">
        	<option value="inner">市内公交线路查询</option>
            <option value="long">城际客车线路查询</option>
        </select>
        <form action="http://zuoche.com/touch/searchplan.jspx" id="inner" method="get">
        		所在城市:<br>
                <input type="text" name="c1" value="江门"/>
                 <center>(所在城市可修改)</center>
        		出发地:<br>
        		<input type="text" name="s"/>
                目的地:<br>
                <input type="text" name="d"/>
                <input type="hidden" name="time" value="4096"/>
                <input type="hidden" name="op" value="inner"/>
                <input type="submit" value="查询"/>
                <center>(点击查询后稍等)</center>
        </form>
        <form action="http://zuoche.com/touch/searchplan.jspx" id="long" style="display:none;" method="get">
        		出发城市:<br>
        		<input type="text" name="s" value="江门"/>
                <center>(出发城市可修改)</center>
                目的城市:<br>
                <input type="text" name="d"/>
                <input type="hidden" name="tool" value="0"/>
                <input type="hidden" name="op" value="long"/>
                <input type="submit" value="查询"/>
                <center>(点击查询后稍等)</center>
        </form>
  </div>
  <div data-role="footer">
  </div>
</div>

<div data-role="page" id="newspage">
	<div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a>
    <h1>五邑大学最新资讯</h1>
  </div>
  <div data-role="content" id="newstitles">
  		(若有学生组织需要发布新闻，联系邮箱739319867@qq.com,免费发布学生活动信息)
  		<ul data-role="listview" data-inset="true"  id="newslist">
        	<li data-role="list-divider">最新资讯</li>
        </ul>
  </div>
  <div data-role="footer" data-position="fixed">
  </div>
</div>

<div data-role="page" id="newscontentpage">
	<div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a>
    <h1 id="newstitle">新闻内容</h1>
  </div>
  <div data-role="content" id="newscontent">
  <br><br><br><br><br><a data-role="button" href="#newspage">请进入资讯页面</a>
  </div>
  <div data-role="footer">
  </div>
</div>

<div data-role="page" id="shoppingpage">
	<div data-role="header">
    <a data-icon="home" href="#homepage" >首页</a>
    <h1>五邑大学周边</h1>
  </div>
  <div data-role="content" id="coursecontent">
		<h2>五邑大学周边</h2>
         <ul data-role="listview" data-inset="true"  data-filter="true" data-filter-placeholder="搜索 ...">
         	<li data-role="list-divider">校内</li>
            <li><div>医务室(新宿舍楼下)</div><div class="right">(生活医疗)</div><br></li>
            <li><div>美宜佳(新宿舍，即西区)</div><div class="right">(生活购物)</div><br></li>
			<li><div>广发银行(南主楼楼下)</div><div class="right">(生活金融)</div><br></li>
			<li><div>联通服务厅(开网续网业务)<br>(南主楼楼下)</div><div class="right">(校园生活)</div><br></li>
			<li><div>书吧(南主楼楼下)</div><div class="right">(校园生活)</div><br></li>
            
            <li data-role="list-divider">北门</li>
			<li><div>中信银行</div><div class="right">(生活金融)</div><br></li>
			<li><div>中国建设银行</div><div class="right">(生活金融)</div><br></li>
			<li><div>江门市第二人民医院</div><div class="right">(生活医疗)</div><br></li>
            <li><div>益华广场</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>益华超市</div><div class="right">(生活购物)</div><br></li>
            <li><div>丰乐市场</div><div class="right">(生活购物)</div><br></li>
            <li><div>丰乐宾馆</div><div class="right">(生活悠闲)</div><br></li>
            <li><div>逸豪酒店</div><div class="right">(生活悠闲)</div><br></li>
            <li><div>流动空间KTV</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>肯德基(益华广场)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>必胜客(益华广场)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>蕉叶(益华广场)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>京华KTV(益华广场)</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>大地电影院(益华广场)</div><div class="right">(生活娱乐)</div><br></li>
			<li><div>17.5影城(电影院)(双龙广场)</div><div class="right">(生活娱乐)</div><br></li>
            
            <li data-role="list-divider">南门</li>
			<li><div>工商银行</div><div class="right">(生活金融)</div><br></li>
			<li><div>中国银行</div><div class="right">(生活金融)</div><br></li>
            <li><div>江门市人民医院</div><div class="right">(生活医疗)</div><br></li>
			<li><div>横岭市场</div><div class="right">(生活购物)</div><br></li>
			<li><div>胜利市场</div><div class="right">(生活购物)</div><br></li>
            <li><div>江门公汽中心站(旧站)</div><div class="right">(交通出行)</div><br></li>
            <li><div>电脑城</div><div class="right">(电脑器件)</div><br></li>
            <li><div>东湖公园</div><div class="right">（休闲娱乐）</div><br></li>
			<li><div>东湖影剧院(电影院)</div><div class="right">（生活娱乐）</div><br></li>
            <li><div>大家乐</div><div class="right">(生活饮食)</div><br></li>
            <li><div>真功夫（电脑城）</div><div class="right">(生活饮食)</div><br></li>
            <li><div>真功夫（地王广场）</div><div class="right">(生活饮食)</div><br></li>
            <li><div>江门体育场</div><div class="right">（运动）</div><br></li>
            <li><div>缤纷广场</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>地王广场</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>大地电影院(地王广场)</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>大昌超市(地王广场店)</div><div class="right">(生活购物)</div><br></li>
            <li><div>金蓝海广场</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>缤纷广场</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>五邑城</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>江门步行街</div><div class="right">(购物娱乐饮食)</div><br></li>
            <li><div>麦当劳(步行街)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>麦当劳(东湖广场)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>肯德基(东湖广场)</div><div class="right">(生活饮食)</div><br></li>
            <li><div>金发KTV</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>凯乐KTV</div><div class="right">(生活娱乐)</div><br></li>
            
            <li data-role="list-divider">西门</li>
            <li><div>西门两旁水果店</div><div class="right">(生活购物)</div><br></li>
            <li><div>华润万家超市</div><div class="right">(生活购物)</div><br></li>
            <li><div>天空之城KTV</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>火星湖电影院</div><div class="right">(生活娱乐)</div><br></li>
            <li><div>大昌超市</div><div class="right">(生活购物)</div><br></li>
            <li><div>麦当劳</div><div class="right">(生活饮食)</div><br></li>
            <li><div>甜味豆浆</div><div class="right">(生活饮食)</div><br></li>
          </ul>
  </div>
  <div data-role="footer">
  </div>
</div>
</body>
</html>
<script>
var args=getArgs();
var hash=window.location.hash;
var Search=window.location.search;
$("div[data-role=header]").attr("data-theme","b");
$("div[data-role=header]").attr("data-position","fixed");
$("div[data-role=footer]").attr("data-theme","b");
$("div[data-role=footer]").attr("data-position","fixed");
$last_news_id=-1;
initNewsContent();
function initNewsContent(){//直接进入新闻页面初始化
	if(hash=="#newscontentpage")
	{
		if(typeof args['id'] != "undefined")
			toNewsContent(args['id']);
	}
	return;
}
$("div[data-role=footer]").html('<div data-role="navbar"><ul> <li><a href="#homepage" data-icon="home" data-transition="flip">主页</a></li><li><a href="#" data-rel="back" data-icon="back">返回</a></li></ul></div>');
document.ready=function(){//刷新页面内容
	toggleLoadGif();
	$.get("dealnews.php",{action:"getnewslist"},function(data,textStatus,jhr){
		var $newsObj;
		$newsObj=JSON.parse(jhr.responseText);
		for(var x in $newsObj){
			$li=document.createElement("li");
			$JQli=$($li);
			$JQli.attr("name","newstitle");
			$JQli.attr("value",$newsObj[x].id);
			$JQli.attr("onclick","toNewsContent(this.value)");
			$JQli.html('<a data-transition="slide" href="?id='+$newsObj[x].id+'#newscontentpage" data-theme="">'+$newsObj[x].title+"</a>");
			$("ul#newslist").get(0).appendChild($li);
		}
		toggleLoadGif();
		$("ul#newslist").listview("refresh");
	});
};
function toggleLoadGif(){
	if($("img.loadgif").css("display")=="none")
		$("img.loadgif").css("display","");
	else
		$("img.loadgif").css("display","none");
}
function getCetScore(){
	if(!$("input#zkzh").val()||!$("input#xm").val()){
		toTipsDialog("有项目没有填写完成");
		return;
	}
	toggleLoadGif();
	$.get("getCetScore.php",
		{zkzh:$("input#zkzh").val(),xm:$("input#xm").val()},
		function(data,textStatus,jhr){
			if(jhr.responseText.match("table"))
				$returnText=jhr.responseText;
			else
				$returnText='<center><h1><font color="red">查不到成绩<br>请检查填写的资料或稍后再试</center></h1></center>';
			$("div#cetscorecontent").html("");
			$("div#cetscorecontent").html("<center>此页面不支持转发</center><br><br><br><br><br>"+$returnText);
			window.location.href="#cetscorepage";
		}
	);
	toggleLoadGif();
}
function toNewsContent($id){
	if($id==$last_news_id)
		return;
	$("div#newscontent").html('<br><br><br><br><br><br><br><center><font color="green">加载中，请稍等....</font><br><img src="css/images/ajax-loader.gif" class="loadgif"/></center>');
	$.get("dealnews.php",{id:$id,action:"getnewscontent"},function(data,textStatus,jhr){
		$newsContentObj=JSON.parse(jhr.responseText);
		if($newsContentObj.content)//判断是否有新闻内容
			0;
		else
		{
			aHTML='<a href="#newspage" data-role="button" data-corners="true" data-transition="slide"  data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="c" class="ui-btn ui-shadow ui-btn-corner-all ui-btn-hover-c ui-btn-up-c"><span class="ui-btn-inner"><span class="ui-btn-text">查看更多邑大资讯</span></span></a>';
			$("div#newscontent").html('<br><br><br><br><br><center><font color="red">该资讯已经out了<br>已经被与时俱进的开发人员删除！</font></center>'+aHTML);
			return;
		}
		$("div#newscontent").html("<center>(欢迎关注微信公众号wyubozhi获得更多服务<br>查成绩查公交，一站完成)</center><center><h3>"+$newsContentObj.title+"</center></h3>"+'<font color="blue">阅读('+$newsContentObj.click_amount+")</font><br>"+$newsContentObj.content);
		$("title").html(delHtmlTag($newsContentObj.title+"(博智平台，专属邑大的资讯平台)"));
		$("h1#newstitle").html($newsContentObj.title);
	});
	$last_news_id=$id
}
function toTipsDialog(s){
	$("div#tips").html("<center>"+s+"</center>");
	window.location.href="#tips_dialog";
}
function checkForm(obj){
	if(!$("input#username").val()||!$("input#password").val()||!$("select#action").val()){
		toTipsDialog("有项目没有填写完成");
		return;
	}
	else{
		toggleLoadGif();
		htmlobj=$.post("index.php",{
			username:$("input#username").val(),
			password:$("input#password").val(),
			action:$("select#action").val()
		},function(d,t,jh){
			try{
				$obj=JSON.parse(jh.responseText);
			}
			catch(excepetion){
				toTipsDialog("账号或密码错误");
				return;
			}
			if($("select#action").val()=="score"){
				$("ul#scorelist").html("");
				$scoreObj=$obj['score'];
				var numerator=0;
				var denominator=0;
				for(var x1 in $scoreObj){
					var li=document.createElement("li");
					$(li).attr('data-role',"list-divider");
					$(li).html($scoreObj[x1][0]);
					$("ul#scorelist").get(0).appendChild(li);
					for(var x2 in $scoreObj[x1][1])
					{
						var li=document.createElement("li");
						if(($scoreObj[x1][1][x2][5]!="重修")&&($scoreObj[x1][1][x2][2]=="必修"||$scoreObj[x1][1][x2][2]=="选修"))
						{
							var score=0;
							var str=$scoreObj[x1][1][x2][4];
							if(str=="优秀")
								score=4.5;
							else if(str=="良好")
								score=3.5;
							else if(str=="中等")
								score=2.5;
							else if(str=="及格")
								score=1;
							else if(str=="不及格")
								score=0;
							else if(str=="旷考")
								score=0;
							else
							{
									if($scoreObj[x1][1][x2][4]<60)
										score=0;
									else
										score=($scoreObj[x1][1][x2][4]-50)/10;
							}
							numerator=numerator+(score*$scoreObj[x1][1][x2][3]);
							denominator=denominator+parseFloat($scoreObj[x1][1][x2][3]);
						}
						$(li).html("<div><div>"+$scoreObj[x1][1][x2][1]+'</div><div class="right">'+$scoreObj[x1][1][x2][4]+"</div><br></div>");
						$("ul#scorelist").get(0).appendChild(li);
					}
					if(x1%2==1)
					{
						var sum=numerator/denominator;
						var li=document.createElement("li");
						$(li).attr('data-role',"list-divider");
						$(li).html('<div><div>本年度绩点</div><div class="right"><center>'+sum+"</center><center>(仅供参考)</center></div><br><br></div>");
						$("ul#scorelist").get(0).appendChild(li);
						if(x1!=$scoreObj.length-1){
							var lii=document.createElement("li");
							$("ul#scorelist").get(0).appendChild(lii);
						}
						numerator=0;
						denominator=0;
					}
				}
				window.location.href="#scorepage";
				$("ul#scorelist").listview("refresh");
			}
			else if($("select#action").val()=="course"){
				$("table#coursetable").html(" ");
				for(var x0 in $obj){
					var tr=document.createElement("tr");
					$subobj=$obj[x0];
					for(var x1 in $subobj){
						if(x1>5)
							break;
						var td=document.createElement("td");
						$strArr=$subobj[x1].split(" ");
						var s="";
						for(var k in $strArr){
							s=s+"<center>"+$strArr[k]+"</center>";
						}
						s='<font size="1px">'+s+'</font>';
						td.innerHTML=s;
						tr.appendChild(td);
					}
					document.getElementById("coursetable").appendChild(tr);
				}
				window.location.href="#coursepage";
			}
		})
	toggleLoadGif();
	}
}
function getArgs() {
    var args = {};
    var query = location.search.substring(1);
    var pairs = query.split("&");
     for(var i = 0; i < pairs.length; i++) {
            var pos = pairs[i].indexOf('=');
            if (pos == -1) continue;
                var argname = pairs[i].substring(0,pos);
                var value = pairs[i].substring(pos+1);
                value = decodeURIComponent(value);
                args[argname] = value;
        }
    return args;
 }
function delHtmlTag(str)
{
	return str.replace(/<[^>]+>/g,"");//去掉所有的html标记
}
function changeForm(obj){
	$("form#long").css("display","none");
	$("form#inner").css("display","none");
	$("form#"+obj.value).css("display","");
	$("h2#buslinetitle").html($("option[value="+obj.value+"]").html());
}
function onBridgeReady(){
 WeixinJSBridge.call('hideOptionMenu');
}

if (typeof WeixinJSBridge == "undefined"){
    if( document.addEventListener ){
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
    }else if (document.attachEvent){
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
    }
}else{
    onBridgeReady();
}
function changeWCity(){
	$city=document.getElementById("wcity").value;
	try{
		$ctPinYin=CC2PY($city);
	}
	catch(e){
		alert('输入正确的城市名');
	}
	$("iframe#weatherif").attr("SRC","http://cache.xixik.com.cn/3/"+$ctPinYin+"/");
}

</script>